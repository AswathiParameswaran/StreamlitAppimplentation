import streamlit as st
import pandas as pd
import joblib
from sklearn.metrics import classification_report, confusion_matrix
import matplotlib.pyplot as plt
import seaborn as sns

st.title("Heart Disease Prediction System")

uploaded_file = st.file_uploader("Upload Test Dataset (CSV)", type=["csv"])

model_choice = st.selectbox(
    "Select Model",
    ["Logistic Regression", "Decision Tree", "KNN",
     "Naive Bayes", "Random Forest", "XGBoost"]
)

if uploaded_file:
    data = pd.read_csv(uploaded_file)
    st.write("Uploaded Data Preview")
    st.dataframe(data.head())

    model = joblib.load(f"model/{model_choice}.pkl")

    X = data.drop("target", axis=1)
    y = data["target"]

    predictions = model.predict(X)

    st.write("### Classification Report")
    report = classification_report(y, predictions, output_dict=True)
    st.write(pd.DataFrame(report).transpose())

    st.write("### Confusion Matrix")
    cm = confusion_matrix(y, predictions)

    fig, ax = plt.subplots()
    sns.heatmap(cm, annot=True, fmt="d", cmap="Blues")
    st.pyplot(fig)
